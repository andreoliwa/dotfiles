- name: "Install apt packages"
  apt: name="{{ apt_packages }}" state=latest
  become: true
  when:
    - 'ansible_os_family == "OSMC" or ansible_system_vendor == "DigitalOcean"'
    - "'apt_packages' | run_only_after"

# Sad face loop - open /dev/fb0: Permission denied - Help and Support / Raspberry Pi - OSMC Forums
# https://discourse.osmc.tv/t/sad-face-loop-open-dev-fb0-permission-denied/87539?u=andreoliwa
- name: "Add osmc to video group"
  user:
    name: osmc
    groups: video
    append: yes
  become: true

- import_tasks: pipx.yml

- import_tasks: subtitles.yml
  when: ansible_os_family == "OSMC"

- name: "Create ~/OneDrive/Backup"
  file:
    state: directory
    path: ~/OneDrive/Backup
  when: ansible_distribution == "Amazon" or ansible_system_vendor == "DigitalOcean"

- name: Clone container-apps
  git:
    repo: https://github.com/andreoliwa/container-apps
    dest: ~/container-apps
    clone: yes
    update: yes
  when: ansible_distribution == "Amazon" or ansible_system_vendor == "DigitalOcean"

- name: Clone container-apps-private
  git:
    repo: git@github.com:andreoliwa/container-apps-private.git
    dest: ~/container-apps-private
    clone: yes
    update: yes
  when: ansible_os_family == "OSMC"
