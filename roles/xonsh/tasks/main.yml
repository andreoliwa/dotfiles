# Installation and setup
- include_tasks: "{{ ansible_os_family | lower }}.yml"

- name: Link xonshrc file
  file:
    src: "{{ dotfiles_home }}/roles/xonsh/files/xonshrc.xsh.link"
    dest: "{{ dotfiles_user_home }}/.xonshrc"
    state: link

- name: "Install Xontribs (with xpip install)"
  with_items: '{{ xontribs }}'
  command: "xonsh --no-rc -c 'xpip install -U {{ item.install }}'"

- name: "Remove ~/.xonsh_xontrib_load"
  file:
    state: absent
    path: "{{ dotfiles_user_home }}/.xonsh_xontrib_load"

- name: "Load Xontribs (using ~/.xonsh_xontrib_load)"
  with_items: '{{ xontribs }}'
  lineinfile:
    path: "{{ dotfiles_user_home }}/.xonsh_xontrib_load"
    state: present
    create: yes
    regexp: "{{ item.load }}"
    line: "xontrib load {{ item.load }}"

- name: Link global .autoxsh file
  file:
    src: "{{ dotfiles_home }}/roles/xonsh/files/autoxsh.xsh.link"
    dest: "{{ dotfiles_user_home }}/.autoxsh"
    state: link

# TODO xpip install -U pip
# TODO xpip install -U prompt_toolkit is failing with $SHELL_TYPE='ptk2'
# the solution is to "xpip uninstall prompt_toolkit"
