- include_tasks: "install.yml"

- name: Link xonshrc file
  file:
    src: "{{ dotfiles_home }}/roles/xonsh/files/xonshrc.xsh.link"
    dest: "{{ dotfiles_user_home }}/.xonshrc"
    state: link

- name: Location of xonsh executable
  command: which xonsh
  register: which_xonsh
  become: true
  tags: bootstrap

- name: Add xonsh to /etc/shells
  lineinfile:
    regexp: 'xonsh'
    line: "{{ which_xonsh.stdout }}"
    dest: /etc/shells
    state: present
  become: true
  tags: bootstrap

- include_tasks: "default_shell.yml"
  tags: bootstrap

- include_tasks: "xontribs.yml"

- name: Link global .autoxsh file
  file:
    src: "{{ dotfiles_home }}/roles/xonsh/files/autoxsh.xsh.link"
    dest: "{{ dotfiles_user_home }}/.autoxsh"
    state: link

# TODO xpip install -U pip
# TODO xpip install -U prompt_toolkit is failing with $SHELL_TYPE='ptk2'
# the solution is to "xpip uninstall prompt_toolkit"
