- name: "Install Xontribs (xpip install)"
  with_items: '{{ xontribs }}'
  command: "xonsh --no-rc -c 'xpip install -U {{ item.install }}'"
  when: ansible_os_family == "Darwin"

- name: "Install Xontribs (system Python 3)"
  with_items: '{{ xontribs }}'
  pip:
    name: "{{ item.install }}"
    state: latest
    executable: pip3
  when: ansible_os_family != "Darwin"
  ignore_errors: true

- name: "Remove ~/.xonsh_xontrib_load"
  file:
    state: absent
    path: "{{ dotfiles_user_home }}/.xonsh_xontrib_load"

- name: "Load Xontribs (using ~/.xonsh_xontrib_load)"
  with_items: '{{ xontribs }}'
  lineinfile:
    path: "{{ dotfiles_user_home }}/.xonsh_xontrib_load"
    state: present
    create: yes
    regexp: "{{ item.load }}"
    line: "xontrib load {{ item.load }}"
